var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.wbWebRTCUI=t()}(this,function(){"use strict";var e={stringifyData:function(e,t){void 0===t&&(t=!1);var c=[];for(var a in e)c.push(a+"="+(t?encodeURIComponent(e[a]):e[a]));return c.join("&")},request:function(t){if("undefined"!=typeof XMLHttpRequest){var c=new XMLHttpRequest;void 0!==c.timeout&&(c.timeout=6e3);var a=t.method.toUpperCase(),n=t.data,o=t.url,i=t.headers,l=t.success,s=t.fail;if("GET"===a&&"object"===(void 0===n?"undefined":_typeof(n))&&n&&(o+="?"+e.stringifyData(n,!0)),c.open(a,o,!0),void 0!==i)for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&c.setRequestHeader(d,i[d]);"POST"===a?(c.setRequestHeader("Content-type","application/json"),c.send(n)):c.send(),void 0===l&&(l=function(){}),void 0===s&&(s=function(){}),c.onreadystatechange=function(){4==c.readyState&&l(c.responseText,c.status,c)},c.onerror=function(e){s(c,0,e)}}else console.log("Function XMLHttpRequest is undefined.")},eventEmitter:function(){function e(){this.events={}}return e.prototype.on=function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},e.prototype.emit=function(e,t){var c,a,n=this.events[e],o=Array.prototype.slice.call(arguments,1);if(n)for(c=0,a=n.length;c<a;c++)n[c].apply(null,o)},e},countTime:{timer:null,timeStr:"00 : 00",start:function(e){this.timer&&clearInterval(this.timer),this.elems=document.querySelectorAll(e);var t,c=0,a=0,n=0,o=this;o.timer=setInterval(function(){if(!o.elems)return clearInterval(o.timer),void(o.timer=null);t=n?o.checkTime(n)+" : "+o.checkTime(a)+" : "+o.checkTime(c):o.checkTime(a)+" : "+o.checkTime(c),o.timeStr=t,o.elems.forEach(function(e){e.innerHTML=t}),++c>=60&&(a++,c=0),a>=60&&(n++,a=0)},1e3)},end:function(){clearInterval(this.timer),this.timer=null,this.timeStr="00 : 00",this.elems&&this.elems.forEach(function(e){e.innerHTML="00 : 00"}),this.elems=null},checkTime:function(e){return e<10&&(e="0"+e),e}},toast:function(e){var t=document.createElement("div");t.setAttribute("id","toast"),t.className="chat-toast",t.innerHTML=e.message,document.body.appendChild(t),t.classList.add("chat-toast-fadeIn"),setTimeout(function(){t.classList.remove("chat-toast-fadeIn"),t.classList.add("chat-toast-fadeOut"),t.addEventListener("animationend",function(){t.classList.add("chat-toast-hide")})},e.time)},confirm:function(e){var t=document.createElement("div");t.className="chat-mui-popup-backdrop chat-mui-active",t.innerHTML=['<div class="chat-mui-popup chat-mui-popup-in">','<div class="chat-mui-popup-inner">','<div class="chat-mui-popup-title">'+e.title+"</div>",'<div class="chat-mui-popup-text">'+e.message+"</div></div>",'<div class="chat-mui-popup-buttons">','<span class="chat-mui-popup-button chat-cancel">'+e.btnText[0]+"</span>",'<span class="chat-mui-popup-button chat-confirm">'+e.btnText[1]+"</span></div></div>"].join("");var c=function(){t&&t.parentNode&&t.parentNode.removeChild(t),t=null};return document.body.appendChild(t),document.querySelector(".chat-mui-popup .chat-cancel").onclick=function(){e.cancel&&e.cancel(),c()},document.querySelector(".chat-mui-popup .chat-confirm").onclick=function(){e.confirm&&e.confirm(),c()},{element:t,close:function(){t&&t.parentNode&&t.parentNode.removeChild(t),t=null}}},loading:{start:function(){var t=e.getElems(".chat-loading-span"),c=2;this.timer=setInterval(function(){t.forEach(function(e,t){e.style.opacity=.3*c,0==--c&&(c=3),2==t&&0==--c&&(c=3)})},1e3)},stop:function(){clearInterval(this.timer),this.timer=null}},loadingMsg:{timerList:[],start:function(e){var t=[".","..","..."],c=0,a=setInterval(function(){e.innerText=t[c],c=++c%3},1e3);this.timerList.push(a)},stop:function(){this.timerList.forEach(function(e){clearInterval(e),e=null}),this.timerList=[]}},getClientHeight:function(){return document.body.clientHeight},getClientWidth:function(){return document.body.clientWidth},getElems:function(e){return document.querySelectorAll(e)},getElem:function(e){return document.querySelector(e)},getId:function(e){return document.getElementById(e)},addClass:function(e,t){if(e)if(""==e.className)e.className+=t;else{var c=e.className.split(" ");-1==c.indexOf(t)&&(c.push(t),e.className=c.join(" "))}},removeClass:function(e,t){if(e){var c=e.className.split(" "),a=c.indexOf(t);-1!=a&&(c.splice(a,1),e.className=c.join(" "))}},toggleClass:function(e,t){if(e){var c=e.className.split(" "),a=c.indexOf(t);-1!=a?c.splice(a,1):c.push(t),e.className=c.join(" ")}},hasClass:function(e,t){if(e)return e.className.split(" ").indexOf(t)>-1},setStyle:function(e,t){if(e)for(var c in t)e.style[c]=t[c]},createDom:function(e,t){var c=document.createElement("div");return c.className=e,c.innerHTML=t,document.body.appendChild(c),c},hideDom:function(e){document.querySelector(e).style.display="none"},showDom:function(e){document.querySelector(e).style.display="block"},base64Encode:function(e){var t,c,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=(function(){for(var e={},t=0,c=a.length;t<c;t++)e[a.charAt(t)]=t}(),String.fromCharCode),o=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?n(192|t>>>6)+n(128|63&t):n(224|t>>>12&15)+n(128|t>>>6&63)+n(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return n(240|t>>>18&7)+n(128|t>>>12&63)+n(128|t>>>6&63)+n(128|63&t)},i=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,l=function(e){var t=[0,2,1][e.length%3],c=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[a.charAt(c>>>18),a.charAt(c>>>12&63),t>=2?"=":a.charAt(c>>>6&63),t>=1?"=":a.charAt(63&c)].join("")},s=function(e){return function(e){return e.replace(i,o)}(e).replace(/[\s\S]{1,3}/g,l)};new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g");return t=e,c?s(String(t)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):s(String(t))},encrypt:function(e){if(null==e||0==e.length)return"";var t=this.base64Encode(e),c=0,a=t.indexOf("=");-1!==a&&(c=t.length-a,t=t.substring(0,a)),t=(t+=c).replace(/\+/g,"-").replace(/\//g,"_");var n=Math.floor(t.length/2);return t.substring(n)+t.substring(0,n)},stackBlurImage:function(e,t,c,a,n){var o=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],i=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function l(e,t,c,a,n){var l=document.getElementById(e),d=l.naturalWidth,h=l.naturalHeight,r=document.getElementById(t);r.style.width=n.width+"px",r.style.height=n.height+"px",r.width=d,r.height=h;var u=r.getContext("2d");u.clearRect(0,0,d,h),u.drawImage(l,0,0),isNaN(c)||c<1||function(e,t,c,a,n,l){if(isNaN(l)||l<1)return;l|=0;var d,h=document.getElementById(e).getContext("2d");try{d=h.getImageData(t,c,a,n)}catch(e){throw new Error("Unable to get image data: "+e)}var r,u,p,v,m,g,f,y,_,b,w,E,x,T,k,S,I,C,A,D,L,V,N,H,j=d.data,M=l+l+1,R=a-1,q=n-1,O=l+1,F=O*(O+1)/2,B=new s,U=B;for(p=1;p<M;p++)if(U=U.next=new s,p==O)var W=U;U.next=B;var P=null,X=null;f=g=0;var G=o[l],Y=i[l];for(u=0;u<n;u++){for(S=I=C=A=y=_=b=w=0,E=O*(D=j[g]),x=O*(L=j[g+1]),T=O*(V=j[g+2]),k=O*(N=j[g+3]),y+=F*D,_+=F*L,b+=F*V,w+=F*N,U=B,p=0;p<O;p++)U.r=D,U.g=L,U.b=V,U.a=N,U=U.next;for(p=1;p<O;p++)v=g+((R<p?R:p)<<2),y+=(U.r=D=j[v])*(H=O-p),_+=(U.g=L=j[v+1])*H,b+=(U.b=V=j[v+2])*H,w+=(U.a=N=j[v+3])*H,S+=D,I+=L,C+=V,A+=N,U=U.next;for(P=B,X=W,r=0;r<a;r++)j[g+3]=N=w*G>>Y,0!=N?(N=255/N,j[g]=(y*G>>Y)*N,j[g+1]=(_*G>>Y)*N,j[g+2]=(b*G>>Y)*N):j[g]=j[g+1]=j[g+2]=0,y-=E,_-=x,b-=T,w-=k,E-=P.r,x-=P.g,T-=P.b,k-=P.a,v=f+((v=r+l+1)<R?v:R)<<2,S+=P.r=j[v],I+=P.g=j[v+1],C+=P.b=j[v+2],A+=P.a=j[v+3],y+=S,_+=I,b+=C,w+=A,P=P.next,E+=D=X.r,x+=L=X.g,T+=V=X.b,k+=N=X.a,S-=D,I-=L,C-=V,A-=N,X=X.next,g+=4;f+=a}for(r=0;r<a;r++){for(I=C=A=S=_=b=w=y=0,E=O*(D=j[g=r<<2]),x=O*(L=j[g+1]),T=O*(V=j[g+2]),k=O*(N=j[g+3]),y+=F*D,_+=F*L,b+=F*V,w+=F*N,U=B,p=0;p<O;p++)U.r=D,U.g=L,U.b=V,U.a=N,U=U.next;for(m=a,p=1;p<=l;p++)g=m+r<<2,y+=(U.r=D=j[g])*(H=O-p),_+=(U.g=L=j[g+1])*H,b+=(U.b=V=j[g+2])*H,w+=(U.a=N=j[g+3])*H,S+=D,I+=L,C+=V,A+=N,U=U.next,p<q&&(m+=a);for(g=r,P=B,X=W,u=0;u<n;u++)j[(v=g<<2)+3]=N=w*G>>Y,N>0?(N=255/N,j[v]=(y*G>>Y)*N,j[v+1]=(_*G>>Y)*N,j[v+2]=(b*G>>Y)*N):j[v]=j[v+1]=j[v+2]=0,y-=E,_-=x,b-=T,w-=k,E-=P.r,x-=P.g,T-=P.b,k-=P.a,v=r+((v=u+O)<q?v:q)*a<<2,y+=S+=P.r=j[v],_+=I+=P.g=j[v+1],b+=C+=P.b=j[v+2],w+=A+=P.a=j[v+3],P=P.next,E+=D=X.r,x+=L=X.g,T+=V=X.b,k+=N=X.a,S-=D,I-=L,C-=V,A-=N,X=X.next,g+=a}h.putImageData(d,t,c)}(t,0,0,d,h,c)}function s(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}l(e,t,c,0,n)},loadBlurImg:function(t,c,a,n){var o=e.getId(t);o.setAttribute("crossOrigin","Anonymous"),o.src=c+"?"+Math.random(),o.onload=function(){e.stackBlurImage(t,a,30,!0,n)}},getOSType:function(){return/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)?"ios":/(Android)/i.test(navigator.userAgent)?"android":"pc"},isWifi:function(){var e,t=navigator.userAgent,c=t.match(/NetType\/\w+/)?t.match(/NetType\/\w+/)[0]:"NetType/other";switch(c=c.toLowerCase().replace("nettype/","")){case"wifi":e="wifi";break;case"4g":e="4g";break;case"3g":case"3gnet":e="3g";break;case"2g":e="2g";break;default:e="other"}return"wifi"===e},wbDebugger:{log:function(){"true"===window.localStorage.getItem("webrtc_debug")&&"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}};return{getInstance:function(t){var c,a,n=!1;window.URL=window.URL||window.webkitURL||window.msURL||window.oURL;var o=null,i=null,l=null,s=!1,d=!(!t||!t.allowRing)&&t.allowRing,h=new(e.eventEmitter()),r=!1;e.createDom("call-audio",'<audio id="callAudio" src="https://j1.58cdn.com.cn/git/webrtc/AVMSG_calling.mp3" loop></audio>');e.createDom("chat-window chat-page chat-launch-video-page",'  \n    <video class="chat-video-cover chat-audio-video" id="launchLocalVideo" autoplay playsinline muted></video>\n    <div class="chat-user-info">\n        <img class="chat-avatar" src="" alt="">\n        <p class="chat-nickname">58同城</p>\n        <p class="chat-notice" id="chat_launch_video_notice">正在等待对方接受邀请<span class="chat-loading-text">...</span></p>\n        <i class="chat-scale"></i>\n    </div>\n    <div class="chat-video-bottom">  \n        <div class="chat-video-btn"> \n            <i class="chat-video-icon chat-cancel"></i>\n            <p>取消</p>\n        </div>\n        <div class="chat-video-btn">\n            <i class="chat-video-icon chat-switch-audio"></i>\n            <p>切换到语音聊天</p>\n        </div>\n    </div>');e.createDom("chat-window chat-page chat-receive-video-page",'\n    <canvas id="canvas_video_4" class="chat-canvas"></canvas>\n    <div class="chat-user-info">\n        <img class="chat-avatar" id="chat_avatar_4">\n        <p class="chat-nickname">58同城</p>\n        <p class="chat-notice">正在邀请你视频聊天<span class="chat-loading-text">...</span></p>\n        <i class="chat-close"></i>\n    </div>\n    <div class="chat-video-bottom">\n        <div class="chat-video-btn">\n            <i class="chat-video-icon chat-cancel"></i>\n            <p>取消</p>\n        </div>\n        <div class="chat-video-btn">\n            <i class="chat-video-icon chat-switch-audio"></i>\n            <p>切换到语音聊天</p>\n        </div>\n        <div class="chat-video-btn">\n            <i class="chat-video-icon chat-accept"></i>\n            <p>接听</p>\n        </div>\n    </div>');e.createDom("chat-window chat-page chat-video-connect-page",'\n    <video class="local-video chat-audio-video" id="localVideo" autoplay playsinline muted></video>\n    <video class="remote-video chat-audio-video" id="remoteVideo" autoplay playsinline></video>\n    <div class="chat-video-cover-content"><i class="chat-scale"></i>\n    <p class="chat-video-time chat-count-time" id="videoTimer">00 : 00</p>\n    <div class="chat-video-bottom">\n        <div class="chat-video-btn">\n            <i class="chat-video-icon chat-close-microphone"></i>\n            <p class="chat-close-msg">静音</p>\n        </div>\n        <div class="chat-video-btn">\n            <i class="chat-video-icon chat-cancel"></i>\n            <p>取消</p>\n        </div>\n        <div class="chat-video-btn">\n            <i class="chat-video-icon chat-switch-audio"></i>\n            <p>切换到语音聊天</p>\n        </div>\n    </div></div>');e.createDom("chat-window chat-page chat-launch-voice-page",'\n        <canvas id="canvas_voice_1" class="chat-canvas"></canvas>\n        <div class="chat-user-info">\n    <img class="chat-avatar" id="chat_avatar_1" src="" alt="">\n    <div class="chat-info">\n        <p class="chat-nickname">58同城</p>\n        <p class="chat-notice">正在等待对方接受邀请<span class="chat-loading-text">...</span></p>\n        <div class="chat-loading">\n            <span class="chat-loading-span"></span>\n            <span class="chat-loading-span"></span>\n            <span class="chat-loading-span"></span>\n        </div>\n        <p class="chat-notice-bg chat-hide"><p class="chat-notice-2 chat-hide">对方未及时接听，建议稍后再次尝试</p></p>\n    </div>\n    <div class="chat-voice-btn chat-bottom-cancel">\n        <i class="chat-voice-icon chat-cancel"></i>\n        <p>取消</p>\n    </div>');e.createDom("chat-window chat-page chat-receive-voice-page",'\n        <canvas id="canvas_voice_3" class="chat-canvas"></canvas>\n    <div class="chat-user-info">\n        <img class="chat-avatar" id="chat_avatar_3" src="" alt="">\n        <p class="chat-nickname">58同城</p>\n        <p class="chat-notice">正在邀请你语音聊天<span class="chat-loading-text">...</span></p>\n        <i class="chat-close"></i>\n    </div>\n      <div class="chat-voice-btn chat-voice-cancel">\n            <i class="chat-voice-icon chat-cancel"></i>\n            <p>取消</p>\n        </div>\n        <div class="chat-voice-btn chat-voice-accept">\n            <i class="chat-voice-icon chat-accept"></i>\n            <p>接听</p>\n        </div>');e.createDom("chat-window chat-page chat-voice-connect-page",'\n        <canvas id="canvas_voice_2" class="chat-canvas"></canvas>\n    <img class="chat-avatar" id="chat_avatar_2" src="" alt="">\n    <div class="chat-info">\n        <p class="chat-nickname">58同城</p>\n        <p class="chat-voice-time chat-count-time" id="voiceTimer">00 : 00</p>\n    </div>\n    <div class="chat-voice-btn chat-bottom-microphone">\n        <i class="chat-voice-icon chat-microphone chat-close-microphone"></i>\n        <p class="chat-close-msg">静音</p>\n    </div>\n    <div class="chat-voice-btn chat-bottom-cancel">\n        <i class="chat-voice-icon chat-cancel"></i>\n    </div>'),e.getElem(".chat-launch-video-page .chat-cancel").onclick=function(){e.hideDom(".chat-launch-video-page"),h.emit("page_event_code",{code:100})},e.getElem(".chat-launch-video-page .chat-switch-audio").onclick=function(){h.emit("audio_page",{type:"launch"}),h.emit("page_event_code",{code:101}),e.toast({message:"已切换至语音通话",time:1500})},e.getElem(".chat-receive-video-page .chat-close").onclick=function(){e.hideDom(".chat-receive-video-page"),h.emit("page_event_code",{code:102})},e.getElem(".chat-receive-video-page .chat-cancel").onclick=function(){e.hideDom(".chat-receive-video-page"),h.emit("page_event_code",{code:102})},e.getElem(".chat-receive-video-page .chat-accept").onclick=function(){h.emit("page_event_code",{code:103})},e.getElem(".chat-receive-video-page .chat-switch-audio").onclick=function(){h.emit("page_event_code",{code:104}),e.toast({message:"已切换至语音通话",time:1500})},e.getElem(".chat-video-connect-page").onclick=function(){e.showDom(".chat-video-cover-content"),m()},e.getElem(".chat-video-connect-page .chat-switch-audio").onclick=function(){h.emit("audio_page",{type:"connect"}),h.emit("page_event_code",{code:107}),e.toast({message:"已切换至语音通话",time:1500})},e.getElem(".chat-video-connect-page .chat-cancel").onclick=function(){e.hideDom(".chat-video-connect-page"),h.emit("page_event_code",{code:108})},e.getElem(".chat-launch-voice-page .chat-cancel").onclick=function(){e.hideDom(".chat-launch-voice-page"),h.emit("page_event_code",{code:110})},e.getElem(".chat-receive-voice-page .chat-close").onclick=function(){e.hideDom(".chat-receive-voice-page"),h.emit("page_event_code",{code:111})},e.getElem(".chat-receive-voice-page .chat-cancel").onclick=function(){h.emit("page_event_code",{code:111}),h.emit("close_page",{})},e.getElem(".chat-receive-voice-page .chat-accept").onclick=function(){h.emit("page_event_code",{code:112})},e.getElem(".chat-voice-connect-page .chat-cancel").onclick=function(){e.hideDom(".chat-voice-connect-page"),h.emit("page_event_code",{code:115})},e.getElem(".chat-voice-connect-page .chat-close-microphone").onclick=function(){var t=e.getElem(".chat-voice-connect-page .chat-close-msg");t.innerText=t.innerText.indexOf("关闭")>-1?"静音":"关闭静音",e.toggleClass(e.getElem(".chat-voice-connect-page .chat-close-microphone"),"chat-open-microphone"),h.emit("page_event_code",{code:116})},e.getElem(".chat-video-connect-page .chat-close-microphone").onclick=function(){var t=e.getElem(".chat-video-connect-page .chat-close-msg");t.innerText=t.innerText.indexOf("关闭")>-1?"静音":"关闭静音",e.toggleClass(e.getElem(".chat-video-connect-page .chat-close-microphone"),"chat-open-microphone"),h.emit("page_event_code",{code:116})},e.getElem(".chat-page.chat-video-connect-page .chat-scale").onclick=function(){var t=e.getElem(".chat-video-connect-page");e.toggleClass(t,"chat-video-large");var c=e.getElem(".chat-video-connect-page .local-video");e.toggleClass(c,"chat-local-video-large");var a=e.getId("localVideo"),o=e.getId("remoteVideo");o.removeAttribute("style"),e.hasClass(c,"chat-local-video-large")?(e.setStyle(t,{left:"0",top:"0"}),e.setStyle(o,{width:"100%",height:"100%",objectFit:n&&!s?"contain":"cover"}),h.emit("page_event_code",{code:120})):(n&&(e.setStyle(a,{left:"10px",top:"10px"}),e.setStyle(o,{width:"100%",height:"100%",objectFit:"cover"})),document.body.clientHeight<640?e.setStyle(t,{left:"calc(50% - 180px)",top:"calc(50% - 200px)"}):e.setStyle(t,{left:"calc(50% - 180px)",top:"calc(50% - 320px)"}),h.emit("page_event_code",{code:119}))},e.getElem(".chat-page.chat-launch-video-page .chat-scale").onclick=function(){var t=e.getElem(".chat-launch-video-page");e.toggleClass(t,"chat-video-large");var c=e.getElem(".chat-launch-video-page .chat-nickname"),a=e.getId("launchLocalVideo");a.removeAttribute("style"),e.hasClass(t,"chat-video-large")?(c.style.width="calc(100% - 180px)",e.setStyle(t,{left:"0",top:"0"}),e.setStyle(a,{width:"100%",height:"100%",objectFit:"cover"}),h.emit("page_event_code",{code:118})):(c.style.width="180px",document.body.clientHeight<640?e.setStyle(t,{left:"calc(50% - 180px)",top:"calc(50% - 200px)"}):e.setStyle(t,{left:"calc(50% - 180px)",top:"calc(50% - 320px)"}),h.emit("page_event_code",{code:117}))},e.getElem(".local-video").onclick=function(){if(c&&a){var t=e.getId("localVideo"),o=e.getId("remoteVideo");s?(v("remoteVideo",a),v("localVideo",c),t.muted=!0,o.muted=!1):(v("remoteVideo",c),v("localVideo",a),t.muted=!1,o.muted=!0),s=!s,n&&e.setStyle(remoteVideo,{objectFit:s?"cover":"contain"})}};var u={dom:e.getElem("#callAudio"),play:function(){if(d){this.dom.load();try{this.dom.play()}catch(e){console.log(e)}}},stop:function(){d&&this.dom.pause()}},p=null;function v(t,c){var a=e.getId(t);if(a)if(window.URL)try{a.srcObject=c}catch(e){a.src=window.URL.createObjectURL(c)}else a.src=c}function m(){"video_page_connect"==l&&(i&&clearTimeout(i),i=setTimeout(function(){e.hideDom(".chat-video-cover-content")},5e3))}function g(t){var c,a,n,o=e.getElem(t);o.removeAttribute("style"),o.onmousedown=function(e){var t=e||window.event,i=t.target||t.srcElement;a=t.clientX-o.offsetLeft,n=t.clientY-o.offsetTop,c=i},document.onmousemove=function(e){if(c){var t=e||window.event,i=t.clientX-a,l=t.clientY-n,s=document.documentElement||document.body;i<0&&(i=0),i>s.offsetWidth-o.offsetWidth&&(i=s.offsetWidth-o.offsetWidth),l<0&&(l=0),l>s.offsetHeight-o.offsetHeight&&(l=s.offsetHeight-o.offsetHeight),c.style.cursor="move",o.style.left=i+"px",o.style.top=l+"px"}},document.onmouseup=function(e){c&&(c.style.cursor=""),c=null}}return h.on("audio_page",function(t){h.emit("close_page",{}),l="audio_page_"+t.type,e.loadingMsg.stop(),"launch"==t.type?(p=setTimeout(function(){var t=e.getElem(".chat-launch-voice-page .chat-notice-bg"),c=e.getElem(".chat-launch-voice-page .chat-notice-2");e.removeClass(t,"chat-hide"),e.removeClass(c,"chat-hide"),p=null},2e4),e.loadBlurImg("chat_avatar_1",o.headimgurl,"canvas_voice_1",{width:300,height:420}),e.loading.start(),e.loadingMsg.start(e.getElem(".chat-launch-voice-page .chat-loading-text")),g(".chat-launch-voice-page"),e.showDom(".chat-launch-voice-page"),u.play()):"connect"==t.type?(r=!0,clearTimeout(p),p=null,e.loadBlurImg("chat_avatar_2",o.headimgurl,"canvas_voice_2",{width:300,height:420}),e.getElem(".chat-voice-connect-page .chat-close-msg").innerText="静音",e.removeClass(e.getElem(".chat-voice-connect-page .chat-close-microphone"),"chat-open-microphone"),g(".chat-voice-connect-page"),e.showDom(".chat-voice-connect-page"),u.stop()):"receive"==t.type&&(e.loadBlurImg("chat_avatar_3",o.headimgurl,"canvas_voice_3",{width:360,height:300}),e.loadingMsg.start(e.getElem(".chat-receive-voice-page .chat-loading-text")),e.showDom(".chat-receive-voice-page"),u.play())}),h.on("video_page",function(t){h.emit("close_page",{}),l="video_page_"+t.type,e.loadingMsg.stop();var a=document.body.clientHeight;if("launch"==t.type){g(".chat-launch-video-page");var i=e.getElem(".chat-launch-video-page");a<640&&(i.style.height=a+"px"),e.getElem(".chat-launch-video-page .chat-nickname").style.width="180px",e.removeClass(i,"chat-video-large"),e.showDom(".chat-launch-video-page"),e.loadingMsg.start(e.getElem(".chat-launch-video-page .chat-loading-text")),p=setTimeout(function(){e.toast({message:"对方未及时接听，建议稍后再次尝试",time:1500}),p=null},2e4),u.play()}else if("connect"==t.type){r=!0,clearTimeout(p),p=null;var d=setInterval(function(){c&&(n?(e.setStyle(localVideo,{left:"10px",top:"10px"}),e.setStyle(remoteVideo,{width:"100%",height:"100%",objectFit:"cover"})):e.getId("remoteVideo").style.width="100%",v("localVideo",c),clearInterval(d))},10);s=!1,e.removeClass(e.getElem(".chat-video-connect-page"),"chat-video-large"),e.removeClass(e.getElem(".chat-video-connect-page .local-video"),"chat-local-video-large"),e.getElem(".chat-video-connect-page .chat-close-msg").innerText="静音",e.removeClass(e.getElem(".chat-video-connect-page .chat-close-microphone"),"chat-open-microphone"),e.getId("localVideo").muted=!0,e.getId("remoteVideo").muted=!1,g(".chat-video-connect-page"),i=e.getElem(".chat-video-connect-page"),a<640&&(i.style.height=a+"px"),e.showDom(".chat-video-cover-content"),e.showDom(".chat-video-connect-page"),u.stop()}else"receive"==t.type&&(e.loadBlurImg("chat_avatar_4",o.headimgurl,"canvas_video_4",{width:360,height:300}),e.loadingMsg.start(e.getElem(".chat-receive-video-page .chat-loading-text")),e.showDom(".chat-receive-video-page"),u.play())}),h.on("output_msg",function(t){var o=t.type;"localStream"==o?v("launchLocalVideo",c=t.stream):"remoteStream"==o?(v("remoteVideo",a=t.stream),e.countTime.start(".chat-count-time"),m()):"resolution"==o&&(n=!0)}),h.on("close_page",function(t){document.querySelectorAll(".chat-window").forEach(function(e){e.style.display="none"}),e.getElem(".chat-page.chat-launch-video-page .chat-scale").removeAttribute("style"),e.getElem(".chat-page.chat-video-connect-page .chat-scale").removeAttribute("style"),e.getId("localVideo").removeAttribute("style"),e.getId("remoteVideo").removeAttribute("style");var c=e.getElem(".chat-launch-voice-page .chat-notice-bg"),a=e.getElem(".chat-launch-voice-page .chat-notice-2");e.addClass(c,"chat-hide"),e.addClass(a,"chat-hide"),clearTimeout(p),p=null,l=null}),h.on("clear_stream",function(t){u.stop();var o=e.countTime.timeStr;"00 : 00"==o&&(o="00 : 01"),r&&t.callTime&&t.callTime({time:o}),r=!1,e.countTime.end(),e.loadingMsg.stop(),e.loading.stop(),c&&c.getTracks().forEach(function(e){e.stop()}),a&&a.getTracks().forEach(function(e){e.stop()}),c=null,a=null,e.getId("localVideo").muted=!0,e.getId("remoteVideo").muted=!1,s=!1,n=!1,document.querySelectorAll(".chat-audio-video").forEach(function(e){e&&(e.src="")})}),h.on("user_info",function(e){o=e,document.querySelectorAll(".chat-avatar").forEach(function(t){t.src=e.headimgurl}),document.querySelectorAll(".chat-nickname").forEach(function(t){t.innerText=e.nickname})}),h},utils:e}});